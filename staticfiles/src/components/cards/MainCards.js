import{v as $,a as f,d as A,u as L,e as d,j as e,B as n,m as g,q as m,k as i,f as l,z as T,A as _,S as M,s as O,E as Q,J as b}from"../../../vendor.js";import{R as v}from"../Ratings.js";import{a as V,c as G}from"../../redux/actions/productActions.js";import{P as H}from"../../redux/constants/productConstants.js";import{h as N,i as Y,j as J,k as U,l as K,m as S,n as X}from"../../../async-vendor.js";const ae=()=>{const y=$(),[x,R]=f.useState(1),c=A(),{id:o}=L(),w=d(t=>t.productDetails),{loading:k,error:u,product:s}=w,C=d(t=>t.userLogin),{userInfo:h}=C,z=d(t=>t.productCreateReview),{loading:Z,error:ee,success:j}=z;f.useEffect(()=>{j&&c({type:H}),o&&c(V(o))},[c,o,j]);const I=({field:t,form:a,...r})=>{const{name:p,value:W}=t,{setFieldValue:P}=a;return e.jsxs(n,{mt:2,mb:2,children:[e.jsx(i,{component:"legend",children:"Rating"}),e.jsx(Q,{name:p,value:W,precision:.5,onChange:(te,B)=>{P(p,B)},...r})]})},D=()=>{y(`/cart/${o}?qty=${x}`)},q={rating:0,comment:""},E=N().shape({rating:Y().required("Rating is required"),comment:J().required("Comment is required")}),F=async(t,{resetForm:a})=>{const r=await c(G(o,t));r&&r.success?(b.fire({icon:"success",title:"Review Added!",text:"Your review has been successfully added."}),a()):b.fire({icon:"error",title:"Oops...",text:r?r.error:"Failed to add review."})};return e.jsxs(n,{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",mt:4,mb:4,minHeight:"calc(100vh - 128px)",color:"black",sx:{fontSize:"0.875rem"},children:[e.jsx(g,{to:"/",style:{textDecoration:"none"},children:e.jsx(m,{variant:"contained",sx:{fontWeight:"bold",mb:4},children:"Go Back"})}),k?e.jsx(i,{children:"Loading..."}):u?e.jsx(i,{color:"error",children:u}):e.jsxs(l,{container:!0,spacing:2,justifyContent:"center",alignItems:"stretch",mb:8,children:[e.jsxs(l,{item:!0,xs:12,md:6,children:[e.jsx(n,{component:"img",src:s.image,alt:s.name,sx:{width:"100%",height:"auto",objectFit:"contain"}}),e.jsxs(n,{p:2,children:[e.jsx(i,{variant:"h4",gutterBottom:!0,children:"Reviews"}),s.reviews.length===0?e.jsx(i,{children:"No reviews yet."}):s.reviews.map(t=>e.jsxs(n,{mb:2,children:[e.jsxs(i,{variant:"subtitle1",children:[e.jsx("strong",{children:t.name})," -"," ",e.jsx(v,{value:t.rating})]}),e.jsx(i,{variant:"body1",children:t.comment})]},t._id))]}),!h&&e.jsx(i,{variant:"subtitle2",mt:2,children:e.jsx(g,{to:"/login",style:{textDecoration:"none",color:"inherit"},children:"Log in to leave a review"})}),h&&e.jsxs(n,{p:2,mt:4,width:"96.5%",border:"1px solid #ccc",borderRadius:"8px",bgcolor:"#f9f9f9",children:[e.jsx(i,{variant:"h5",sx:{mb:2},children:"Add Your Review"}),e.jsx(U,{initialValues:q,validationSchema:E,onSubmit:F,children:({submitForm:t,isSubmitting:a})=>e.jsx(K,{children:e.jsxs(n,{display:"flex",flexDirection:"column",children:[e.jsx(S,{component:I,name:"rating",label:"Rating",precision:.5}),e.jsx(S,{component:X,name:"comment",label:"Comment",multiline:!0,rows:4,variant:"outlined",fullWidth:!0,margin:"normal"}),e.jsx(m,{variant:"contained",color:"primary",disabled:a,onClick:t,sx:{mt:2},children:"Submit"})]})})})]})]}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsxs(n,{p:2,display:"flex",flexDirection:"column",height:"100%",pl:2,children:[e.jsx(i,{sx:{fontWeight:"bold",fontSize:"2.5rem"},children:s.name}),e.jsx(i,{sx:{mt:2,fontWeight:"bold",fontSize:"1.5rem"},children:e.jsx(v,{value:s.rating,text:`${s.numReviews} reviews`,starSize:"1.5rem",textSize:"1.5rem"})}),e.jsxs(i,{sx:{mt:6,fontSize:"1.5rem",fontWeight:"bold"},children:["Rs. ",s.price]}),e.jsx(i,{sx:{mt:10,fontSize:"1.5rem",fontWeight:"bold"},children:"Description:"}),e.jsx(i,{sx:{fontSize:"1.25rem"},children:s.description})]})}),e.jsx(l,{item:!0,xs:12,md:3,children:e.jsxs(n,{p:2,display:"flex",flexDirection:"column",justifyContent:"center",children:[e.jsxs(i,{sx:{mt:1,mb:2,fontSize:"2.5rem",fontWeight:"bold",borderBottom:"1px solid black"},children:["Rs. ",s.price]}),e.jsxs(i,{sx:{mt:1,mb:2,fontSize:"1.25rem",borderBottom:"1px solid black",color:`${s.countInStock>0?"green":"red"}`},children:["Status: ",s.countInStock>0?"In Stock":"Out of Stock"]}),s.countInStock>0&&e.jsx(n,{sx:{display:"flex","& > *":{m:1}},children:e.jsxs(T,{sx:{m:0,width:"100%"},children:[e.jsx(_,{id:"qty",sx:{fontSize:"1.25rem"},children:"Quantity"}),e.jsx(M,{labelId:"qty",id:"qty-select",value:x,label:"Quantity",onChange:t=>R(t.target.value),size:"small",sx:{width:"100%"},children:[...Array(s.countInStock).keys()].map(t=>e.jsx(O,{value:t+1,sx:{fontSize:"1.25rem"},children:t+1},t+1))})]})}),e.jsx(m,{variant:"contained",size:"large",sx:{fontWeight:"bold",fontSize:"1.5rem",mt:2,width:"100%"},onClick:D,disabled:s.countInStock===0,children:"Add to Cart"})]})})]})]})};export{ae as M};
